2019/06/21

環境変数

- AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY
- TASKNAME
- TIMELIMIT
- DB_URL, DB_USER, DB_PASS

alpine上でinstallしたcrystalがまともに動かん
https://github.com/sam0x17/crystal-alpine
を参考に色々ライブラリ足した（alpineを使っている意味が…）
→やっぱりサイズでかくなってしまって意味がないのでベースイメージはcrystalのものを使おう

DBテーブル定義
CREATE TABLE results (
	id INTEGER UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
	task VARCHAR(255) NOT NULL,
	created_at DATETIME NOT NULL, 
	score INTEGER UNSIGNED NOT NULL,
	commands MEDIUMTEXT,
	options JSON DEFAULT NULL
);


2019/06/22 12:18

AWS BatchでS3からソースコード取得→実行→結果をRDSに入れる
までできた

AWS ACCESS KEY系はIAM Roleでやるから渡す必要なかった
AWS BatchにどうやってDBの認証情報渡せばいいんだ…ソースコード内には書きたくないが
よくわからんので仕方ないがプレインテキストの環境変数かなあ

手元からジョブを投げられるようにする

12:50

投げることはできた
https://qiita.com/aokad/items/aed8034fb087a6bf99c3
がRUNNABLEから動かない…
スポットリクエスト作られてないなあ→数分待ったら作られた
OK

ごはん



